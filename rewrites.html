<!DOCTYPE html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<style>
  .reload {
    font-family: Lucida Sans Unicode
  }
</style>
<script>
  // on ducment load call AJAX to get the data
  function strToHTML(str) {
    //string to JSON
    var obj = JSON.parse(str);
    var htmlString = "";
    //loop through the JSON object
    for (var i = 0; i < obj.length; i++) {
      var isUnanswerbale = obj[i]["Answer"] == "UNANSWERABLE"
      htmlString += "<b>Question " + (i+1).toString() + ":</b> " + obj[i]["Question"] + "<br>";
      htmlString += "<b>Rewrite " + (i+1).toString() + ":</b> " + obj[i]["Rewrite"] + "<br>";
      if (!isUnanswerbale){
        htmlString += "<div class='rationale' style='display:none'><b>Rationale :</b> <i>" + obj[i]["Rationale"] + "</i><br></div>";
      }
      htmlString += "<b>Answer " + (i+1).toString() + ":</b> " + obj[i]["Answer"] + "<br>";
      if (!isUnanswerbale){
        var hrefLink = "https://en.wikipedia.org/wiki/" + obj[i]["Topic"].replaceAll(" ", "_");
        if (obj[i]["Topic_section"] != "Introduction")
          hrefLink += "#" + obj[i]["Topic_section"].replaceAll(" ", "_");
        htmlString += "<b>Web Page :</b> <i>" + "<a href='" + hrefLink + "' target='_blank'>" + obj[i]["Topic"] + " (" + obj[i]["Topic_section"] + ")</a></i><br>";
        }
      htmlString += "<br>";
    }

    return htmlString;
  }
  function getConversation() {
    console.log("ready!");
    $.ajax({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': '*'
      },
      type: 'GET',
      dataType: 'json',
      url: 'https://5du8ytlzg9.execute-api.us-east-2.amazonaws.com/default/topiocqaGetExample',
      success: function(data) {
        console.log(data["body"]);
        $("#datasetExplorer").html(strToHTML(data["body"]));
      }, error: function(data) {
        $("#datasetExplorer").html("<p>Failed to load conversation, please try after some time.</p>");
      }
    });
  }
  function toggleVisible() {
  var toggleElements = document.getElementsByClassName("rationale");
    for (var i = 0; i < toggleElements.length; i++) {
        toggleElements[i].style.display = toggleElements[i].style.display == "none" ? "block" : "none";
    }
}
  $(document).ready(function() {
    getConversation();
  });
</script>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <title>TopiOCQA</title>
    <link rel="icon" href="https://mcgill-nlp.github.io/topiocqa/topiocqa_no_background.png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  </head>
  <body>

    <header class="page-header" role="banner" style="background-image: linear-gradient(120deg, #d7816a, #bd4f6c);">
      <h2 class="project-name"><img src="topiocqa_no_background.png" alt="logo" width="100" height="100" style="margin-bottom: -20px;"/>TopiOCQA: Open-domain Conversational Question Answering with Topic Switching</h2>
      <h2 class="project-tagline">Vaibhav Adlakha, Shehzaad Dhuliawala, Kaheer Suleman, Harm de Vries, Siva Reddy</h2>
    </header>

    <main id="content" class="main-content" role="main">
        
      <h1 class="dataset-explorer" style="color: #d7816a;">Dataset Explorer <button style="background-color: white; border: 0px;"><span onclick="getConversation()" class=reload>&#x21bb;</span></button></h1>
      <button class="btn btn-primary" onclick="toggleVisible()">Toggle Evidence</button>
      <div class="dataset-explorer-container col-md-12" id="datasetExplorer" style="background-image: linear-gradient(120deg, #fbece8, #f8cad6); padding: 2em;">
        <p>Loading...</p>
      </div>
    </main>
  </body>
</html>
